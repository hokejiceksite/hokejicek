<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hokejíček Chat</title>
  <style>
    body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:#0b0b0b;color:#fff}
    header{padding:10px;background:#111;border-bottom:1px solid #222;display:flex;align-items:center;justify-content:space-between}
    #logo{height:50px}
    .auth button{margin-left:8px;background:#4da3ff;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}
    .auth span{font-size:0.9em;color:#aaa}
    #messages{padding:15px;height:70vh;overflow-y:auto;background:#0f0f0f}
    .msg{padding:6px;border-bottom:1px solid #1a1a1a}
    .meta{color:#aaa;font-size:0.85em;margin-bottom:3px}
    .report{background:#ff4747;color:#fff;border:none;padding:5px;border-radius:6px;cursor:pointer;font-size:0.8em}
    .controls{display:flex;gap:10px;padding:10px;background:#111;border-top:1px solid #222}
    input{flex:1;padding:8px;border-radius:6px;border:none;background:#1a1a1a;color:#fff}
    button#sendBtn{background:#4da3ff;padding:8px 15px;border:none;border-radius:6px;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <img id="logo" src="https://hokejicek.site/files/png/hokejicek-logo.png" alt="logo">
    <div class="auth" id="authArea"></div>
  </header>

  <main id="messages"></main>

  <div class="controls">
    <input id="textInput" placeholder="Napiš zprávu...">
    <button id="sendBtn">Odeslat</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBtf3bEzJU5et-Q11j38QHNMHyOeoOb98A",
      authDomain: "hokejicek-2fe46.firebaseapp.com",
      databaseURL: "https://hokejicek-2fe46-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hokejicek-2fe46",
      storageBucket: "hokejicek-2fe46.appspot.com",
      messagingSenderId: "980610969771",
      appId: "1:980610969771:web:1b03ca9715204ef6bd47ee",
      measurementId: "G-M0FJ2RMY9V"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    const messagesRef = db.ref("messages");
    const usersRef = db.ref("users");

    const authArea = document.getElementById("authArea");
    const messagesEl = document.getElementById("messages");
    const textInput = document.getElementById("textInput");
    const sendBtn = document.getElementById("sendBtn");

    // vykreslení login / logout
    function renderAuth(user) {
      authArea.innerHTML = "";
      if (!user) {
        const regBtn = document.createElement("button");
        regBtn.textContent = "Registrovat";
        regBtn.onclick = register;
        const logBtn = document.createElement("button");
        logBtn.textContent = "Přihlásit";
        logBtn.onclick = login;
        authArea.append(regBtn, logBtn);
      } else {
        const span = document.createElement("span");
        span.textContent = "Přihlášen: " + (user.displayName || user.email);
        const outBtn = document.createElement("button");
        outBtn.textContent = "Odhlásit";
        outBtn.onclick = () => auth.signOut();
        authArea.append(span, outBtn);
      }
    }

    auth.onAuthStateChanged(user => renderAuth(user));

    function register() {
      const name = prompt("Uživatelské jméno (malá písmena, čísla):");
      if (!name) return;
      const valid = /^[a-z0-9_-]{3,20}$/.test(name);
      if (!valid) return alert("Použij 3–20 znaků: a-z 0–9 _ -");
      const pass = prompt("Heslo (min. 6 znaků):");
      if (!pass || pass.length < 6) return alert("Heslo je příliš krátké");
      const email = `${name}@hokejicek.local`;

      firebase.auth().createUserWithEmailAndPassword(email, pass)
        .then(cred => {
          cred.user.updateProfile({ displayName: name });
          usersRef.child(cred.user.uid).set({ username: name, created: Date.now() });
          alert("Účet vytvořen!");
        })
        .catch(e => alert("Chyba: " + e.message));
    }

    function login() {
      const name = prompt("Uživatelské jméno:");
      const pass = prompt("Heslo:");
      if (!name || !pass) return;
      const email = `${name}@hokejicek.local`;
      firebase.auth().signInWithEmailAndPassword(email, pass)
        .catch(e => alert("Chyba přihlášení: " + e.message));
    }

    // přidávání zpráv
    sendBtn.onclick = () => {
      const user = auth.currentUser;
      if (!user) return alert("Musíš být přihlášen.");
      const text = textInput.value.trim();
      if (!text) return;
      const msg = {
        username: user.displayName,
        text: text,
        time: Date.now(),
        userId: user.uid
      };
      messagesRef.push(msg);
      textInput.value = "";
    };

    // načítání zpráv
    messagesRef.limitToLast(100).on("child_added", snap => {
      const msg = snap.val();
      const div = document.createElement("div");
      div.className = "msg";
      div.innerHTML = `
        <div class="meta">${msg.username} • ${new Date(msg.time).toLocaleTimeString()}</div>
        <div>${msg.text}</div>
        <button class="report">Nahlásit</button>
      `;
      div.querySelector(".report").onclick = () => alert("Zpráva nahlášena (zatím test)");
      messagesEl.append(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    });

  </script>
</body>
</html>
