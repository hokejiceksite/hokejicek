<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
#wrap{
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 50% 40%, #1b2a4a 0%, #0b1020 45%, #000 100%);
  display:flex;
  align-items:center;
  justify-content:center;
}
#card{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:18px;
}
#ring{
  width:64px;
  height:64px;
  border-radius:50%;
  border:3px solid rgba(255,255,255,.15);
  border-top-color:#4b8bff;
  animation:spin 1.2s linear infinite;
}
#title{
  color:#fff;
  font-size:22px;
  font-weight:600;
  letter-spacing:1.2px;
}
#sub{
  color:rgba(255,255,255,.6);
  font-size:14px;
  letter-spacing:.6px;
}
video{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:contain;
  background:#000;
  display:none;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div id="wrap">
  <div id="card">
    <div id="ring"></div>
    <div id="title">PŘENOS SE PŘIPRAVUJE</div>
    <div id="sub">Začínáme každým okamžikem</div>
  </div>
</div>

<video id="v" autoplay controls playsinline></video>

<script>
const CHANNEL_MIN = 28;
const CHANNEL_MAX = 36;
const CHECK_INTERVAL = 5000;

const START = new Date("2025-12-29T18:57:00+01:00").getTime();
const END   = new Date("2025-12-29T19:03:00+01:00").getTime();

shaka.polyfill.installAll();
const video = document.getElementById("v");
const wrap = document.getElementById("wrap");
const player = new shaka.Player(video);

async function getMpd(ch){
  try{
    const r = await fetch(
      `https://api.ceskatelevize.cz/video/v1/playlist-live/v1/stream-data/channel/CH_${ch}`,
      { cache:"no-store" }
    );
    if(!r.ok) return null;
    const d = await r.json();
    if(d?.streamUrls?.main && d.isBlocked === false){
      return d.streamUrls.main;
    }
  }catch(e){}
  return null;
}

(async ()=>{
  while(true){
    const now = Date.now();

    if(now >= START && now <= END){
      for(let ch=CHANNEL_MIN; ch<=CHANNEL_MAX; ch++){
        const mpd = await getMpd(ch);
        if(mpd){
          await player.load(mpd);
          wrap.style.display="none";
          video.style.display="block";
          return;
        }
      }
    }

    await new Promise(r=>setTimeout(r, CHECK_INTERVAL));
  }
})();
</script>

</body>
</html>
