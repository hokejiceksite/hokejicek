<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stream JSON Viewer + Player</title>

<style>
:root { color-scheme: dark; }
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#0b0f17;
  color:#fff;
  padding:16px
}
.wrap{max-width:1200px;margin:0 auto}
textarea{
  width:100%;
  height:220px;
  background:#0e1630;
  color:#fff;
  border:1px solid #24365d;
  border-radius:12px;
  padding:12px;
  font-family:ui-monospace,Consolas,monospace
}
button{
  margin-top:10px;
  background:#111a2e;
  color:#fff;
  border:1px solid #24365d;
  border-radius:12px;
  padding:10px 14px;
  cursor:pointer
}
button:hover{border-color:#3f5ea6}
.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
  margin-top:16px
}
@media(min-width:900px){
  .grid{grid-template-columns:1fr 1fr}
}
.card{
  background:#111a2e;
  border:1px solid #24365d;
  border-radius:14px;
  padding:12px
}
.muted{opacity:.75;font-size:13px}
.k{opacity:.75;font-size:12px;margin-top:10px}
.v{word-break:break-all}
code{
  font-family:ui-monospace,Consolas,monospace;
  font-size:12px
}
.playerBox{
  background:#000;
  border-radius:12px;
  overflow:hidden;
  border:1px solid #24365d
}
video{
  width:100%;
  height:360px;
  background:#000
}
.status{
  font-size:12px;
  opacity:.7;
  margin-top:6px
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.compiled.js"></script>
</head>

<body>
<div class="wrap">
  <h1 style="margin:0 0 6px">Stream JSON Viewer</h1>
  <div class="muted">
    Vlož JSON → přehrávač se zobrazí místo náhledu.
  </div>

  <textarea id="jsonInput" placeholder='Sem vlož JSON...'></textarea>
  <button id="loadBtn">Načíst + přehrát</button>

  <div class="grid" id="out" style="display:none">

    <!-- NÁHLED = PŘEHRÁVAČ -->
    <div class="card">
      <div class="muted">Live náhled</div>
      <div class="playerBox">
        <video id="video" controls autoplay></video>
      </div>
      <div class="status" id="status">—</div>
    </div>

    <!-- INFO -->
    <div class="card">
      <div class="muted">Základ</div>
      <div class="k">Název</div><div class="v" id="title"></div>
      <div class="k">ID / Channel</div><div class="v" id="ids"></div>
      <div class="k">Blocked</div><div class="v" id="blocked"></div>
      <div class="k">Kvality</div><div class="v" id="quals"></div>
      <div class="k">Audio</div><div class="v" id="audio"></div>
    </div>

    <!-- ODKAZY -->
    <div class="card" style="grid-column:1/-1">
      <div class="muted">Odkazy (info)</div>
      <div class="k">Main</div><div class="v"><code id="mainUrl"></code></div>
      <div class="k">Timeshift</div><div class="v"><code id="tsUrl"></code></div>
    </div>

  </div>
</div>

<script>
const $ = (id)=>document.getElementById(id);
let player = null;

function safeText(el, text){
  el.textContent = (text ?? "").toString();
}

function setStatus(t){
  $("status").textContent = t;
}

$("loadBtn").onclick = async () => {
  let obj;
  try{
    obj = JSON.parse($("jsonInput").value.trim());
  }catch(e){
    alert("Neplatný JSON.");
    return;
  }

  $("out").style.display = "grid";

  safeText($("title"), obj.title || "");
  safeText($("ids"), `id=${obj.id ?? ""} • assetId=${obj.assetId ?? ""} • channel=${obj.channel ?? ""}`);
  safeText($("blocked"), obj.streamUrls?.isBlocked === true ? "true" : "false");

  const aq = obj.streamUrls?.availableQualities || [];
  const mq = obj.streamUrls?.manifestQualities || [];
  safeText($("quals"), `available: ${aq.join(", ")} | manifest: ${mq.join(", ")}`);

  const tracks = (obj.streamUrls?.audioTracks || []).map(t =>
    `${t.language}/${t.codec}/${t.channels}${t.ad ? " (ad)" : ""}`
  );
  safeText($("audio"), tracks.join(" • "));

  safeText($("mainUrl"), obj.streamUrls?.main || "");
  safeText($("tsUrl"), obj.streamUrls?.timeshift || "");

  const manifestUrl = obj.streamUrls?.main;
  if(!manifestUrl){
    setStatus("Chybí streamUrls.main");
    return;
  }

  shaka.polyfill.installAll();
  if(!shaka.Player.isBrowserSupported()){
    setStatus("Prohlížeč nepodporován");
    return;
  }

  try{
    if(!player){
      player = new shaka.Player($("video"));
      player.addEventListener("error", e=>{
        console.error(e);
        setStatus("Chyba přehrávání");
      });
    }else{
      await player.unload();
    }

    setStatus("Načítám stream…");
    await player.load(manifestUrl);
    setStatus("LIVE");
  }catch(err){
    console.error(err);
    setStatus("Nelze přehrát (CORS / doména / DRM)");
  }
};
</script>

</body>
</html>
