<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin — Hokejíček</title>
  <link rel="icon" href="/favicon.png">
  <style>
    :root{--bg:#ffffff;--text:#07142a;--muted:#556676;--accent:#0B6BFF;--card:#fbfdff}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
    .wrap{max-width:960px;margin:28px auto;padding:20px}
    h1{margin:0 0 12px;font-size:22px}
    .card{background:var(--card);border:1px solid #e6eef6;border-radius:10px;padding:12px;margin-top:12px}
    label{display:block;margin-top:8px;font-weight:600}
    input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef6;margin-top:6px}
    button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #e6eef6;color:var(--accent)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .small{font-size:13px;color:var(--muted)}
    .err{background:#fff1f2;border-left:4px solid #ef4444;padding:10px;border-radius:6px;margin-top:8px;color:#7f1d1d}
    .hint{background:#fffbeb;border-left:4px solid #f59e0b;padding:10px;border-radius:6px;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Admin — Hokejíček (živé přenosy)</h1>

    <div id="statusCard" class="card small">
      <strong>Stav připojení</strong>
      <div id="statusMsg">Inicializuji Firebase…</div>
    </div>

    <div id="authArea" style="display:none">
      <div id="loginCard" class="card">
        <h3>Přihlášení</h3>
        <label for="email">E-mail</label>
        <input id="email" type="email" placeholder="admin@hokejicek.site" autocomplete="username">
        <label for="pass">Heslo</label>
        <input id="pass" type="password" placeholder="••••••••" autocomplete="current-password">
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="btnLogin">Přihlásit</button>
          <button id="btnLoginTest" class="ghost">Instrukce k testu</button>
        </div>
        <div id="authMsg" class="small" style="margin-top:8px"></div>
      </div>

      <div id="adminUI" style="display:none">
        <div class="card">
          <h3>Vytvořit zápas</h3>
          <label>Domácí</label><input id="home" placeholder="Domácí tým">
          <label>Hosté</label><input id="away" placeholder="Hostující tým">
          <label>Start (volitelně)</label><input id="start" placeholder="2025-09-30 18:00">
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="createMatch">Vytvořit zápas</button>
            <button id="refreshMatches" class="ghost">Obnovit seznam</button>
          </div>
          <div id="createdMsg" class="small" style="margin-top:8px"></div>
        </div>

        <div class="card">
          <h3>Přidat událost do zápasu</h3>
          <label>Vyberte zápas</label>
          <select id="matchSelect"></select>
          <label>Text události</label>
          <textarea id="evText" rows="4" placeholder="Např. 12' – Gól: 1–0"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="addEvent">Přidat událost</button>
            <button id="btnLogout" class="ghost" style="margin-left:auto;background:#ef4444;color:#fff;border:0">Odhlásit</button>
          </div>
          <div id="eventMsg" class="small" style="margin-top:8px"></div>
        </div>
      </div>
    </div>

    <div class="card small">
      <strong>Užitečné tipy</strong>
      <ul>
        <li>Přidejte v Firebase Console → <strong>Project settings → Authorized domains</strong> domény: <code>localhost</code>, <code>VAŠE_UZIV_JMENO.github.io</code> a <code>hokejicek.site</code>.</li>
        <li>Realtime Database → Rules: doporučeno <code>{ "rules": { ".read": true, ".write": "auth != null" } }</code>.</li>
        <li>Admin účet přidáte v Console → Authentication → Users → Add user.</li>
      </ul>
    </div>
  </div>

  <!-- Firebase compat (pro čisté HTML / GitHub Pages) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    // ===== ZDE je váš firebaseConfig (copy/paste přesně z Firebase Console) =====
    const firebaseConfig = {
      apiKey: "AIzaSyCpbltZZZ1xq91rL9i92ZBdTNJLSyiahSK",
      authDomain: "hokejicek-live.firebaseapp.com",
      databaseURL: "https://hokejicek-live-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "hokejicek-live",
      storageBucket: "hokejicek-live.appspot.com",
      messagingSenderId: "382599668613",
      appId: "1:382599668613:web:737bc3dd697bc5a1f95aec",
      measurementId: "G-Z3FP66RW29"
    };
    // ========================================================================

    // inicializace
    try {
      firebase.initializeApp(firebaseConfig);
    } catch(e) {
      document.getElementById('statusMsg').innerHTML = '<div class="err">Chyba při inicializaci Firebase: ' + (e.message || e) + '</div>';
      console.error(e);
    }

    const auth = firebase.auth();
    const db = firebase.database();

    const statusMsg = document.getElementById('statusMsg');
    const authArea = document.getElementById('authArea');
    const adminUI = document.getElementById('adminUI');
    const authMsg = document.getElementById('authMsg');

    // zkontrolovat DB dostupnost
    function testDb() {
      if(!db) {
        statusMsg.innerHTML = '<div class="err">Realtime Database není inicializovaná (zkontrolujte databaseURL v configu).</div>';
        authArea.style.display = 'block';
        return;
      }
      db.ref('/').once('value').then(()=> {
        statusMsg.textContent = 'Spojení s Realtime Database OK. Přihlaste se jako admin.';
        authArea.style.display = 'block';
      }).catch(err => {
        statusMsg.innerHTML = '<div class="err">Nelze přistoupit k DB: ' + (err.message || err.code) + '</div>' +
          '<div class="hint">Zkontrolujte Authorized domains v Project settings a pravidla (Rules) v Realtime Database.</div>';
        authArea.style.display = 'block';
        console.error(err);
      });
    }
    testDb();

    // login
    document.getElementById('btnLogin').addEventListener('click', async () => {
      authMsg.textContent = 'Probíhá přihlášení…';
      const email = document.getElementById('email').value.trim();
      const pass = document.getElementById('pass').value;
      if(!email || !pass){ authMsg.textContent = 'Vyplňte e-mail a heslo.'; return; }
      try {
        await auth.signInWithEmailAndPassword(email, pass);
        authMsg.textContent = 'Přihlášení úspěšné.';
      } catch (err) {
        console.error(err);
        let msg = err.message || String(err);
        if(err.code === 'auth/invalid-api-key' || err.code === 'auth/api-key-not-valid') {
          msg = 'Chybný API klíč nebo nepovolená doména. Zkontrolujte firebaseConfig a Authorized domains v konzoli.';
        } else if(err.code === 'auth/user-not-found') {
          msg = 'Uživatel nenalezen. Přidejte admin účet v Firebase Console → Authentication → Users.';
        } else if(err.code === 'auth/wrong-password') {
          msg = 'Špatné heslo.';
        }
        authMsg.innerHTML = '<div class="err">Chyba: ' + msg + '</div>';
      }
    });

    // instrukce k test tlačítku
    document.getElementById('btnLoginTest').addEventListener('click', () => {
      authMsg.textContent = 'Pro otestování přihlášení zadejte e-mail a heslo a klikněte Přihlásit.';
    });

    // react on auth state
    auth.onAuthStateChanged(user => {
      if(user) {
        document.getElementById('loginCard').style.display = 'none';
        adminUI.style.display = 'block';
        loadMatches();
      } else {
        document.getElementById('loginCard').style.display = 'block';
        adminUI.style.display = 'none';
      }
    });

    // create match
    document.getElementById('createMatch').addEventListener('click', async () => {
      const home = document.getElementById('home').value.trim();
      const away = document.getElementById('away').value.trim();
      const start = document.getElementById('start').value.trim();
      if(!home || !away){ document.getElementById('createdMsg').textContent = 'Vyplňte domácí i hosty.'; return; }
      try {
        const ref = db.ref('matches').push();
        await ref.set({ home, away, startTime: start, createdAt: Date.now(), createdBy: auth.currentUser && auth.currentUser.email });
        document.getElementById('createdMsg').textContent = 'Zápas vytvořen: ' + ref.key;
        loadMatches();
      } catch(e) {
        document.getElementById('createdMsg').textContent = 'Chyba: ' + (e.message || e);
      }
    });

    // load matches into select
    async function loadMatches(){
      try {
        const snap = await db.ref('matches').once('value');
        const sel = document.getElementById('matchSelect');
        sel.innerHTML = '';
        if(!snap.exists()){
          const opt = document.createElement('option'); opt.value=''; opt.textContent='Žádné zápasy'; sel.appendChild(opt);
          return;
        }
        snap.forEach(ch => {
          const opt = document.createElement('option'); opt.value = ch.key; opt.textContent = (ch.val().home||'') + ' – ' + (ch.val().away||'');
          sel.appendChild(opt);
        });
      } catch(e) {
        console.error(e);
      }
    }

    // refresh button
    document.getElementById('refreshMatches').addEventListener('click', loadMatches);

    // add event
    document.getElementById('addEvent').addEventListener('click', async () => {
      const matchId = document.getElementById('matchSelect').value;
      const text = document.getElementById('evText').value.trim();
      if(!matchId){ document.getElementById('eventMsg').textContent = 'Vyberte zápas.'; return; }
      if(!text){ document.getElementById('eventMsg').textContent = 'Napište text události.'; return; }
      try {
        const ref = db.ref('events/' + matchId).push();
        await ref.set({ text, createdAt: Date.now(), author: auth.currentUser && auth.currentUser.email });
        document.getElementById('evText').value = '';
        document.getElementById('eventMsg').textContent = 'Událost přidána.';
      } catch(e) {
        document.getElementById('eventMsg').textContent = 'Chyba: ' + (e.message || e);
      }
    });

    // logout
    document.getElementById('btnLogout').addEventListener('click', () => {
      auth.signOut();
    });
  </script>
</body>
</html>
