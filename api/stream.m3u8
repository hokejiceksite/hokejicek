<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HokejÃ­Äek â€“ Stream pÅ™ehrÃ¡vaÄ</title>
  <style>
    body { background: #0b0b0b; color: #fff; font-family: Arial, sans-serif; margin: 0; text-align: center; }
    header { background: #111; padding: 12px; font-size: 20px; border-bottom: 1px solid #222; }
    video { width: 90%; max-width: 960px; margin-top: 20px; background: #000; border-radius: 12px; }
    #status { margin-top: 10px; font-size: 15px; color: #aaa; }
    button { background: #1a73e8; border: none; padding: 10px 20px; border-radius: 8px; color: #fff; font-size: 16px; cursor: pointer; margin-top: 20px; }
  </style>
</head>
<body>
  <header>ğŸ’ HokejÃ­Äek â€“ AutomatickÃ½ vÃ½bÄ›r streamu</header>
  <video id="video" controls playsinline></video>
  <div id="status">Status: hledÃ¡m funkÄnÃ­ zdroj...</div>
  <button id="retry">ğŸ”„ Zkusit znovu</button>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
  <script>
    const SOURCES = [
      "https://lasvideoblobs0prod-standard.b-cdn.net/vods/blobs0/690221713829c1557f6068dd.m3u8",
      "https://lasvideoblobs1prod-standard.b-cdn.net/vods/blobs1/690221713829c1557f6068dd.m3u8",
      "https://lasvideoblobs2prod-standard.b-cdn.net/vods/blobs2/690221713829c1557f6068dd.m3u8"
    ];
    const CHECK_INTERVAL = 10000; // 10s
    const video = document.getElementById("video");
    const status = document.getElementById("status");
    const retryBtn = document.getElementById("retry");
    let currentHls = null;
    let timer = null;

    function setStatus(text) { status.textContent = "Status: " + text; }

    async function testSource(url) {
      try {
        const res = await fetch(url, { method: "HEAD", mode: "no-cors" });
        // fetch s no-cors vracÃ­ opaque, takÅ¾e nevÃ­me status â€” zkusÃ­me fallback s GET
        const test = await fetch(url, { method: "GET" });
        return test.ok;
      } catch {
        return false;
      }
    }

    async function findWorkingSource() {
      setStatus("ZkouÅ¡Ã­m dostupnost zdrojÅ¯...");
      for (const url of SOURCES) {
        const ok = await testSource(url);
        if (ok) {
          setStatus("Nalezen funkÄnÃ­ zdroj âœ…");
          return url;
        }
      }
      setStatus("Å½Ã¡dnÃ½ zdroj nenÃ­ momentÃ¡lnÄ› dostupnÃ½ âŒ");
      return null;
    }

    function playStream(url) {
      if (currentHls) currentHls.destroy();
      if (Hls.isSupported()) {
        const hls = new Hls();
        currentHls = hls;
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play().catch(() => {});
          setStatus("Stream pÅ™ehrÃ¡vÃ¡n âœ”ï¸");
        });
        hls.on(Hls.Events.ERROR, (e, data) => {
          if (data && data.fatal) {
            setStatus("Chyba pÅ™ehrÃ¡vÃ¡nÃ­, zkouÅ¡Ã­m dalÅ¡Ã­ zdroj...");
            hls.destroy();
            startSearchLoop();
          }
        });
      } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
        video.src = url;
        video.play();
        setStatus("Stream pÅ™ehrÃ¡vÃ¡n (nativnÄ›)");
      } else {
        setStatus("Tento prohlÃ­Å¾eÄ nepodporuje HLS");
      }
    }

    async function startSearchLoop() {
      clearInterval(timer);
      const url = await findWorkingSource();
      if (url) playStream(url);
      timer = setInterval(async () => {
        if (video.paused || video.readyState < 2) {
          const u = await findWorkingSource();
          if (u) playStream(u);
        }
      }, CHECK_INTERVAL);
    }

    retryBtn.addEventListener("click", () => {
      if (currentHls) currentHls.destroy();
      startSearchLoop();
    });

    // SpustÃ­ hned pÅ™i naÄtenÃ­
    startSearchLoop();
  </script>
</body>
</html>
